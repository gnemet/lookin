graph LR
    subgraph INPUT["ðŸ’¬ Input"]
        USER["ðŸ‘¤ User Question"]
        MCP_FILE["dwh_mcp.md"]
    end

    subgraph RAG["ðŸ“š RAG (2 modes)"]
        PGVEC["pgvector HNSW"]
        DIRECT["Direct MCP (fallback)"]
    end

    subgraph PIPELINE["ðŸ§  Pipeline"]
        PROMPT["Prompt Assembly"]
        LLM["LLM (Gemini/Ollama)"]
        SQL["ExtractSQL"]
        EXEC["Execute + RLS"]
        SYNTH["NL Synthesis"]
    end

    subgraph OUTPUT["ðŸ’¬ Output"]
        ANSWER["Answer (HU/EN)"]
    end

    USER --> PROMPT
    MCP_FILE --> PGVEC --> PROMPT
    MCP_FILE --> DIRECT --> PROMPT
    PROMPT --> LLM --> SQL --> EXEC --> SYNTH --> ANSWER
