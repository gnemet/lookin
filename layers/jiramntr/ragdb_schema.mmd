graph TB
    subgraph RAGDB["ğŸ§  ragdb â€” RAG Database"]
        direction TB

        subgraph KNOWLEDGE["ğŸ“š Knowledge Store"]
            K["rag.knowledge<br/>topic Â· content Â· source<br/>collection Â· metadata"]
        end

        subgraph EMBEDDINGS["ğŸ”¢ Embeddings"]
            E["rag.embeddings<br/>topic Â· embedding (vector)<br/>provider Â· model Â· collection"]
            E_PART["Partitions:<br/>embeddings_dwh<br/>embeddings_hr<br/>embeddings_meta<br/>embeddings_confluence<br/>embeddings_docs"]
        end

        subgraph ISSUES["ğŸ« Issue Vectors"]
            IE["rag.issue_embeddings<br/>issue_key Â· summary<br/>embedding (vector)"]
        end

        subgraph AUDIT["ğŸ“‹ Audit Trail"]
            AL["rag.audit_log<br/>hl_question Â· generated_sql<br/>status Â· username Â· cost"]
        end

        subgraph FUNCTIONS["âš™ï¸ Functions"]
            F1["fn_search_knowledge()"]
            F2["fn_search_embeddings()"]
            F3["fn_upsert_knowledge()"]
            F4["fn_search_issues()"]
            F5["fn_get_stats()"]
            F6["fn_cleanup_stale()"]
        end
    end

    subgraph PROVIDERS["ğŸ”Œ Embedding Providers"]
        GEMINI["âœ¨ Gemini<br/>text-embedding-004"]
        OLLAMA["ğŸ¦™ Ollama<br/>nomic-embed-text"]
    end

    GEMINI --> E
    OLLAMA --> E
    E --> E_PART
    K --> F1
    E --> F2
